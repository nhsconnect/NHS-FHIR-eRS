<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="How to use FHIR Patient resources to perform Patient Searches">
<meta name="keywords" content="designdevelopment,  development">
<title>Design | Patient Search | eRS</title>
<link rel="stylesheet" href="css/syntax.css">


<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/modern-business.css">
<link rel="stylesheet" href="css/lavish-bootstrap.css">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/theme-blue.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4005/feed.xml">





    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html"> <span class="projectTitle"> FHIR® eRS Referral API</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li>
                <!-- entries without drop-downs appear here -->
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                
                
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Design | Patient Search">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
    <div class="col-lg-12"> </div>
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                








<ul id="mysidebar" class="nav">

 
    <p style="font-size:16px;">
    <img src="images/logo.png" alt="NHS Digital Logo">
    </p>


    <li class="sidebarTitle">eRS FHIR® API 1.0.0 draft</li>
    
    
    
    <li>
        <a href="#">Overview</a>
        <ul>
            
            
            
            <li><a href="index.html">Introduction</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Getting Started</a>
        <ul>
            
            
            
            <li><a href="started_journey.html">Development Journey</a></li>
            
            
            
            
            
            
            <li><a href="started_capabilities.html">Capabilities</a></li>
            
            
            
            
            
            
            <li><a href="started_registration.html">Partner Registration</a></li>
            
            
            
            
            
            
            <li><a href="started_glossary.html">Glossary</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Explore</a>
        <ul>
            
            
            
            <li><a href="explore.html">Overview</a></li>
            
            
            
            
            
            
            <li><a href="explore_api_environment.html">API Environments</a></li>
            
            
            
            
            
            
            <li><a href="explore_endpoint_catalogue.html">Endpoint Catalogue</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Resources</a>
        <ul>
            
            
            
            <li><a href="resources.html">Overview</a></li>
            
            
            
            <li class="subfolders">
                <a href="#">Service Search</a>
                <ul>
                    
                    
                    
                    <li><a href="servicesearch_references.html">References</a></li>
                    
                    
                    
                    
                    
                    <li><a href="resource_healthcareservice.html">HealthcareService</a></li>
                    
                    
                    
                    
                    
                    <li><a href="resource_location.html">Location</a></li>
                    
                    
                    
                    
                    
                    <li><a href="resource_bundle.html">Bundle</a></li>
                    
                    
                    
                </ul>
            </li>
            
            
            
            <li class="subfolders">
                <a href="#">Referrals for Review</a>
                <ul>
                    
                    
                    
                    <li><a href="referralsforreview_references.html">References</a></li>
                    
                    
                    
                </ul>
            </li>
            
            
            
            <li class="subfolders">
                <a href="#">Foundation</a>
                <ul>
                    
                    
                    
                    <li><a href="resources_capabilitystatement.html">CapabilityStatement</a></li>
                    
                    
                    
                </ul>
            </li>
            
            
            
            <li class="subfolders">
                <a href="#">API Guidance | FHIR®</a>
                <ul>
                    
                    
                    
                    <li><a href="explore_api_codes.html">API Codes</a></li>
                    
                    
                    
                    
                    
                    <li><a href="explore_search_parameters.html">Search Parameters</a></li>
                    
                    
                    
                    
                    
                    <li><a href="explore_fhir_open_source_guidance.html">Open Source</a></li>
                    
                    
                    
                    
                    
                    <li><a href="explore_reference.html">Reference</a></li>
                    
                    
                    
                </ul>
            </li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Develop</a>
        <ul>
            
            
            
            <li><a href="develop_business_flows.html">Business Flows</a></li>
            
            
            
            
            
            
            <li><a href="develop_code_samples.html">Code Samples</a></li>
            
            
            
            
            
            
            <li><a href="develop_test_data.html">Test Data</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Assure</a>
        <ul>
            
            
            
            <li><a href="assure_partners.html">Business Partners</a></li>
            
            
            
            
            
            
            <li><a href="assure_approach.html">Assurance Approach</a></li>
            
            
            
            
            
            
            <li><a href="assure_pathtolive.html">Path-To-Live</a></li>
            
            
            
            
        </ul>
     </li>
       
        
    
    <li>
        <a href="#">Deploy</a>
        <ul>
            
            
            
            <li><a href="deploy_methodology.html">Release Methodology</a></li>
            
            
            
            
        </ul>
     </li>
       
        
        
        <!-- if you aren't using the accordion, uncomment this block:
           <p class="external">
               <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
           </p>
           -->
</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
             

<div class="post-header">
   <h1 class="post-title-main">Design | Patient Search</h1>
</div>



<div class="post-content">

   
    <div class="summary">How to use FHIR Patient resources to perform Patient Searches</div>
   

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})

});
</script>

<div id="toc"></div>

    

  
<div class="alert alert-warning" role="alert">
<i class="fa fa-warning"></i> <b>Important:</b> This site is under active development by NHS Digital to develop the eRS APIs. This project is being developed using an agile methodology so iterative updates to content will be added on a regular basis.</div>

<h2 id="0-references">0. References</h2>

<table border="0" width="100%">
    <tr>
        <td><div class="alert alert-info" role="alert">
<i class="fa fa-cogs"></i> <b>Care Connect API:</b> <br> <a href="restfulapis_identification_patient.html">Patient</a> <br>  <a href="restfulapis_identification_practitioner.html">Practitioner</a> <br> <a href="restfulapis_identification_organisation.html">Organization</a> </div></td>
        <td>
<div class="alert alert-success" role="alert">
<i class="fa fa-book"></i> <b>IHE Reference:</b><br> <a href="http://www.ihe.net/uploadedFiles/Documents/ITI/IHE_ITI_Suppl_PDQm.pdf">IHE Patient Demographic Query Mobile (IHE PDQM)</a>
</div> </td>
        <td><div class="alert alert-info" role="alert">
<i class="fa fa fa-exchange"></i> <b>Architecture Patterns:</b><br> <a href="https://developer.nhs.uk/library/architecture/integration-patterns/shared-repository/">Shared Repository</a> </div></td>
</tr>
</table>

<h2 id="1-overview">1. Overview</h2>

<div class="alert alert-info" role="alert">
<i class="fa fa-info-circle"></i> <b>Scenario:</b> A patient visits a emergency department for the first time. The nurse needs to register the patient; in
doing so, it is desired to record the patient’s demographic data in the emergency departments management
information system (ED MIS). The emergency department is connected to a hospital trust’s central
patient registry (typically the Patient Administration System (PAS) or Master Patient Index (MPI)). <br><br>  The nurse issues a patient query request to the central patient registry acting as a
Patient Demographics Supplier, with some basic patient demographics data as search criteria. In the returned patient list, she picks an appropriate record for the patient, including the hospital’s
Patient ID, to enter into the ED MIS. (Note the ED MIS uses a different Patient ID domain than that
of the central patient registry.)</div>

<p>Most NHS trusts will typically have one central system  called the Patient Administration System (PAS) thats holds a master Patient registry of all patients who have had care with the trust. In order to reduce patient administration and improve data quality, all  other MIS within the trusts will be kept in sync with the central registry (PAS) via HL7v2 <a href="http://www.enterpriseintegrationpatterns.com/patterns/messaging/Messaging.html">messaging</a>. Alongside these messages will be patient encounter messages as shown in the diagram below:</p>

<figure><img class="docimage" src="images/IHE/Iti_pam_ip.jpg" alt="Patient Identity Feeds" style="max-width: 200pxpx"><figcaption>Patient Identity Feeds</figcaption></figure>

<p><a href="https://isd.digital.nhs.uk/trud3/user/guest/group/0/pack/1/subpack/200/releases">HL7v2</a> is a mature and widely used standard but it is not suitable for querying patient demographic details (see HL7v2 Patient Demographics Query below). Mostly because it is a messaging standard and not an API. Care Connect API gives an API using <a href="https://en.wikipedia.org/wiki/Representational_state_transfer">RESTful</a> interface following a <a href="http://www.servicedesignpatterns.com/WebServiceAPIStyles/ResourceAPI">resource API pattern</a>
 to provide access to the central Patient repository.
This is particularly suited to:</p>
<ul>
  <li>A health portal securely exposing demographics data to browser based plugins</li>
  <li>Medical devices which need to access patient demographic information</li>
  <li>Mobile devices used by physicians (example bedside eCharts) which need to establish
patient context by scanning a bracelet</li>
  <li>Web based EPR/EHR applications which wish to provide dynamic updates of patient
demographic information such as a non-postback search, additional demographic detail,
etc.</li>
  <li>Any low resource application which exposes patient demographic search functionality</li>
  <li>A facade providing a simple API to a complex interface</li>
</ul>

<h2 id="2-client-patient-search">2. Client Patient Search</h2>

<h3 id="21-foundation">2.1 Foundation</h3>

<figure><img class="docimage" src="images/design/PDQ%20Actor%20Diagram.jpg" alt="Patient Search FHIR Actor Diagram" style="max-width: 200pxpx"><figcaption>Patient Search FHIR Actor Diagram</figcaption></figure>

<p>The patient search can use any of the search parameters defined in the <a href="restfulapis_identification_patient.html">Patient</a> API. For example if the patient informs the nurse of their date of birth, first name (19th Mar 1998 Bernie Kanfeld) and surname the query would be.</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>GET [baseUrl]/Patient?birthdate=1998-03-19&amp;name=bernie%20kanfeld
</code></pre>
</div>

<p><code class="highlighter-rouge">[baseUrl]</code> needs to be replaced with an actual url, in the example below this is <code class="highlighter-rouge">http://127.0.0.1:8181/Dstu2/</code>. The url would work within a web browser but a better tool to work with RESTful is <a href="https://www.getpostman.com/">Postman</a></p>

<div class="highlighter-rouge">
<pre class="highlight"><code>http://127.0.0.1:8181/Dstu2/Patient?birthdate=1998-03-19&amp;name=bernie%20kanfeld
</code></pre>
</div>

<p>A sample response is shown below</p>

<h4 id="xml-example-1---bundle-patient">XML Example 1 - Bundle Patient</h4>

<script src="https://gist.github.com/KevinMayfield/df1eafd6f4b730ba027566219c7fdc83.js"></script>

<p>What we have just described is shown in the diagram below. When entered the url we did a Patient Search FHIR Query and the response is called Patient Search FHIR Query Response.</p>

<figure><img class="docimage" src="images/design/Basic%20Process%20Flow%20PDQm.jpg" alt="Basic Process Flow Patient Search FHIR" style="max-width: 200pxpx"><figcaption>Basic Process Flow</figcaption></figure>

<p>ManagagingOrganisation, the patients GP Practice is given as a reference (Organization/24965)</p>

<div class="language-xml highlighter-rouge">
<pre class="highlight"><code><span class="nt">&lt;managingOrganization&gt;</span>
    <span class="nt">&lt;reference</span> <span class="na">value=</span><span class="s">"Organization/24965"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;display</span> <span class="na">value=</span><span class="s">"Moir Medical Centre"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/managingOrganization&gt;</span>
</code></pre>
</div>

<p>If you wish to know more details about this organisation, you will need to follow the reference. The Reference used in the the example is relative, they can also point to external servers, e.g.:</p>

<div class="language-xml highlighter-rouge">
<pre class="highlight"><code><span class="nt">&lt;managingOrganization&gt;</span>
    <span class="nt">&lt;reference</span> <span class="na">value=</span><span class="s">"https://fhirserver.trust.nhs.uk/DSTU2/Organization/65"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;display</span> <span class="na">value=</span><span class="s">"Moir Medical Centre"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/managingOrganization&gt;</span>
</code></pre>
</div>

<p>We retrieve the Organization resource in the similar manner to searching for the Patient but as we know the <code class="highlighter-rouge">Id</code> of the resource we can access it directly.</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>GET [baseUrl]/Organization/24965
</code></pre>
</div>

<p>The response from this request is shown below, it is not returned in a FHIR <a href="http://www.hl7.org/fhir/dstu2/bundle.html">Bundle</a> as we haven’t performed a search and requested the resource by it’s Id. The SDS/ODS code can be found in the identifier section.</p>

<h4 id="xml-example-2---organization">XML Example 2 - Organization</h4>

<script src="https://gist.github.com/KevinMayfield/6748097c5003220759292726be05c259.js"></script>

<p>The method for returning Practitioner is the similar and an example is shown below in section 2.2</p>

<h3 id="21-identifier">2.1 identifier</h3>

<p>To find a patient by NHS number, Hospital number, etc we use the identifier. The earlier example contained an NHS number, the number 9876543210 belongs to the system <code class="highlighter-rouge">https://fhir.nhs.uk/Id/nhs-number</code>, which is identifier for the NHS Number in England and Wales.</p>

<div class="language-xml highlighter-rouge">
<pre class="highlight"><code><span class="nt">&lt;identifier&gt;</span>
    <span class="nt">&lt;extension</span> <span class="na">url=</span><span class="s">"https://fhir.hl7.org.uk/StructureDefinition/Extension-CareConnect-NHSNumberVerificationStatus-1"</span><span class="nt">&gt;</span>
        ... snip ...
    <span class="nt">&lt;/extension&gt;</span>
    <span class="nt">&lt;system</span> <span class="na">value=</span><span class="s">"https://fhir.nhs.uk/Id/nhs-number"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;value</span> <span class="na">value=</span><span class="s">"9876543210"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/identifier&gt;</span>
</code></pre>
</div>

<p>To search for Patients by NHS number, use the following query:</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>GET [baseUrl]/Patient?identifier=[system]|[code]
</code></pre>
</div>

<p>The system is <code class="highlighter-rouge">https://fhir.nhs.uk/Id/nhs-number</code> and the code is <code class="highlighter-rouge">9876543210</code>, e.g.</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>GET [baseUrl]/Patient?identifier=https://fhir.nhs.uk/Id/nhs-number|9876543210
</code></pre>
</div>

<p>This will return all Patient resources with a NHS number of 9876543210 (this may be more than one). NHS Number may not be the main patient identifier within a NHS Organisation or Health Enterprise, this is for a number of reasons:</p>
<ul>
  <li>Patient doesn’t currently have a NHS Number (foreign visitor or from another home nation in the UK)</li>
  <li>Patient’s NHS number hasn’t been validated (and so can not be used for interoperability/communication)</li>
  <li>Patient has not been identified accurately.</li>
</ul>

<p>For these reasons the trust/health organisation will use it’s own primary identifier, often referred to as Hospital or District number. Organisation’s will need to create their own system for the identifier, in the example Example NHS Trust have used ‘https://fhir.example.nhs.uk/PAS/Patient’ to indicate PAS Hospital Number. They use this with the API as shown below:</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>GET [baseUrl]/Patient?identifier=https://fhir.example.nhs.uk/PAS/Patient|123345
</code></pre>
</div>

<div class="alert alert-info" role="alert">
<i class="fa fa-info-circle"></i> <b>Note:</b> Trust or Organisation can choose to use their main identifier as the logical Id. [TODO add notes about national NHS systems using NHS Number this way.]</div>

<h3 id="22-java-example">2.2. Java Example</h3>

<p>The examples are built using <a href="http://hapifhir.io/">HAPI FHIR</a> which is an open source implementation of the HL7 FHIR specification by the University Health Network, Canada. Source code can be found on <a href="https://github.com/nhsconnect/careconnect-java-examples/blob/master/ImplementationGuideExplore/src/main/java/uk/nhs/careconnect/examples/fhir/ExamplePatient.java">NHSConnect GitHub</a></p>

<p>The first example uses the same search parameters we used earlier, we are searching for patients with a surname of Kanfeld, forename of Bernie and date of birth 19/Mar/1998. The first couple of lines setup a Dstu2 FHIR context and set the baseUrl to be <code class="highlighter-rouge">http://127.0.0.1:8181/Dstu2/</code>. The output from running this code is shown earlier in this guide.</p>

<h4 id="java-example-1---patient-search">Java Example 1 - Patient Search</h4>

<script src="https://gist.github.com/KevinMayfield/b71d1318d5fddf5012b334c74d25f561.js"></script>

<p>The second example would return the same FHIR response but this time the search is using the patients NHS Number.</p>

<h4 id="java-example-2---patient-search-nhs-number">Java Example 2 - Patient Search NHS Number</h4>

<script src="https://gist.github.com/KevinMayfield/007335b96834d986c18a778cd9b28bbd.js"></script>

<p>As previously mentioned these queries have not returned details on the patient GP or Surgery but have provided references to them which allows us to retrieve them.</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>GET [baseUrl]/Organization/24965
</code></pre>
</div>

<div class="highlighter-rouge">
<pre class="highlight"><code>GET [baseUrl]/Practitoner/24967
</code></pre>
</div>

<p>The example belows shows how this could be done using java.</p>

<h4 id="java-example-3---organization-and-practitioner-search">Java Example 3 - Organization and Practitioner Search</h4>

<script src="https://gist.github.com/KevinMayfield/8a333a1acd31a7460ca4fd508b987156.js"></script>

<!--

This is referring to a draft NHS Digital policy

## 3. National (NHS) Patient Search ##

<figure><img class="docimage" src="images/design/National PDQ Actor Diagram.jpg" alt="National NHS Patient Search Actor Diagram" style="max-width: 200pxpx" /><figcaption>National NHS Patient Search Actor Diagram</figcaption></figure>


National systems in England may use the logical Id as the business identiferEnglish NHS will use the NHS Number as the logical Id.  

Currently, the only national resources this would apply to are:
•	Organisation (ODS Code)
•	Patient (NHS Number)
•	Prescription (Prescription ID)
•	Practitioner (SDS ID)


<figure><img class="docimage" src="images/design/National Basic Process Flow PDQm.jpg" alt="National NHS Process Flow PDQ FHIR" style="max-width: 200pxpx" /><figcaption>National NHS Process Flow Patient Search FHIR</figcaption></figure>

-->
<h2 id="3-servergateway-patient-search">3. Server(/Gateway) Patient Search</h2>

<!-- This section is introducing the facade pattern. This may not sound useful but is probably the most common patterns with FHIR in the UK -->
<p>In practice many FHIR Servers will be facades or gateways. <a href="https://en.wikipedia.org/wiki/Facade_pattern">Facades</a> will provide a standardised CareConnect interface to the underlying a SQL database or provide a CareConnectAPI gateway to other patient search systems such NHS Spine Mini Services Provider (SMSP) or HL7v2 Patient queries. In both cases the CareConnect client is insulated away from the interfacing technology or technology stack.</p>

<figure><img class="docimage" src="images/design/Gateway%20PDQ%20Actor%20Diagram.jpg" alt="National NHS Patient Search Actor Diagram" style="max-width: 200pxpx"><figcaption> Implementing Patient Search FHIR as a gateway</figcaption></figure>

<p>The <a href="http://www.servicedesignpatterns.com/webserviceinfrastructures/serviceconnector">Service Connector(/Gateway) Pattern </a>
 can insulate client applications from complex processing which is especially useful for web applications. This would typically be done in a Trust Integration Engine or other middleware products such as Apache Camel. Advantages include:</p>
<ul>
  <li>Insulates clients from the complexities of interoperability.</li>
  <li>Transforms external calls into internal formats (e.g. HL7v2 / HL7v3 XML to FHIR JSON/XML)</li>
  <li>Allows the different security models to work with each other (e.g. OAuth2 based environment working with FHIR API using certificate based authentication)</li>
  <li>Simplifies client access. API Gateway can retrieve demographics from multiple sources with a single query.</li>
</ul>

<p>Consider the HL7v2 Example below:</p>

<h4 id="hl7-version-2-example-1---patient-demographics-query">HL7 version 2 Example 1 - Patient Demographics Query</h4>

<div class="highlighter-rouge">
<pre class="highlight"><code>MSH|^~\&amp;|TEST_HARNESS|TEST|CR1|MOH_CAAT|20090226131520-0600||QBP^Q22^QBP_Q21|TEST-CR-15-20|P|2.5
QPD|Q22^Find Candidates^HL7|Q1520|@PID.8^F~@PID.5.1^JONES
RCP|I|10^RD
</code></pre>
</div>

<p>This is searching for female patients with a surname of Jones. It is not clear from the message this is a search query and also the parameters <code class="highlighter-rouge">@PID.8^F~@PID.5.1^JONES</code> means a female called Jones. Also it’s difficult to call from a web browser based application.
Using a FHIR API Gateway hides this complexity from the client web developer allowing them to use the $http service as shown in the example below:</p>

<h4 id="angularjs-example-1---web-app-client-search">AngularJS Example 1 - Web App Client Search</h4>

<script src="https://gist.github.com/KevinMayfield/88e98c89775ba707dd7a0cf4795b395a.js"></script>

<!--
| SMSP Request | FHIR Patient Search |
|--------------|---------------------|
| getPatientDetailsByNHSNumber| `GET http://[proxyUrl]/Patient?identifier=https://fhir.nhs.uk/Id/nhs-number|[NHSNumber]&birthdate=[DateOfBirth]` |
| getPatientDetailsBySearch | `GET http://[proxyUrl]/Patient?birthdate=[DateOfBirth]&given=[Forename]&family=[Surname]&gender=[Gender]&adddress-postcode=[Postcode]` |
| getPatientDetails| `GET http://[proxyUrl]/Patient?identifier=https://fhir.nhs.uk/Id/nhs-number|[NHSNumber]&birthdate=[DateOfBirth]&given=[Forename]&family=[Surname]&gender=[Gender]&adddress-postcode=[Postcode]` |
-->

<figure><img class="docimage" src="images/design/Gateway%20Process%20Flow%20PDQm.jpg" alt="Gateway Process Flow Patient Search FHIR" style="max-width: 200pxpx"><figcaption>Sample Patient Search FHIR gateway process flow</figcaption></figure>

<h4 id="java-example-4---patient-resource-from-csv-line">Java Example 4 - Patient Resource from CSV line</h4>

<p>Example code for building a FHIR Patient resource from a CSV file can be found on  <a href="https://github.com/nhsconnect/careconnect-java-examples/blob/master/ImplementationGuideExplore/src/main/java/uk/nhs/careconnect/examples/fhir/ExamplePatientCSV.java">GitHub</a>.</p>


    <div class="tags">
        
        <b>Tags: </b>
        
        
        
        <a href="tag_design.html" class="btn btn-default navbar-btn cursorNorm" role="button">design</a>
        
        
        
        <a href="tag_development.html" class="btn btn-default navbar-btn cursorNorm" role="button">development</a>
        
        
        
    </div>

    

</div>

<hr class="shaded">

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
                    <img class="pull-left" src="images/explanatoryline.png" alt="NHS Digital Explanatory Line">
                    <br>
                    ©2018 NHS Digital<br>
                     Site last generated: Apr 10, 2018 <br>
                    b0e0894523a2552132aaa00e87ae0b659fe50de7<br>
                    <br>
                    <!-- OGL Licence -->
                    <div class="open-government-licence">
                        <a href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" rel="license" class="no_icon"><img src="images/licence/ogl-symbol-41px-retina-black.png"></a>
                        <p>All content is available under the <a href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" rel="license" class="no_icon">Open Government Licence v3.0</a>, except where otherwise stated</p>
                    </div>
                </div>
            </div>
</footer>


        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
    </div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-99659472-1', 'auto');
  ga('send', 'pageview');

</script>

 


</body>

</html>
